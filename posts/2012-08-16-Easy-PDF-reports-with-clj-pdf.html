<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="me" href="https://mastodon.social/@yogthos">
    <link rel="me" href="https://mas.to/@yogthos">
    <link rel="me" href="https://social.marxist.network/@yogthos">
    <title>(iterate think thoughts): Easy PDF reports with clj-pdf</title>
    <meta name="description" content="Dmitri&#39;s blog about programming, Clojure, and software development">
    <meta name="keywords" content="">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <link href="/css/site.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)" id="hljs-light">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/tomorrow-night.min.css" media="(prefers-color-scheme: dark)" id="hljs-dark">
    <script>
    (function(){var t=localStorage.getItem('theme');if(t){document.documentElement.setAttribute('data-theme',t);var l=document.getElementById('hljs-light'),d=document.getElementById('hljs-dark');if(l&&d){if(t==='dark'){l.media='not all';d.media='all'}else{l.media='all';d.media='not all'}}}})();
    </script>
</head>
<body>

<aside id="sidebar">

    <p id="logo">
        <a title="(iterate think thoughts)" href="/index.html">
            <span class="text"><span class="paren">(</span><span class="fn">iterate</span>
                <br>
                <span class="text">&nbsp;&nbsp;think</span>
                <br>
                <span class="text">&nbsp;&nbsp;thoughts<span class="paren">)</span>
            </span>
        </a>
    </p>

    <nav id="menucont" class="bodycontainer">
        <button class="menu-toggle" aria-label="Toggle menu">
            <span class="hamburger"></span>
            <span class="menu-label">Menu</span>
        </button>
        <ul class="menu">
            <li ><a title="Home" href="/index.html">Home</a></li>
            <li ><a title="Archives" href="/archives.html">Archives</a></li>
            
            <li ><a title="Tags" href="/tags.html">Tags</a></li>
            
            
            <li >
                <a href="/pages/about.html">About</a>
            </li>
            
            <li><a title="RSS" href="/feed.xml">RSS</a></li>
        </ul>
    </nav>

    <div class="theme-toggle-wrapper">
        <button class="theme-toggle" aria-label="Toggle dark mode">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></svg>
            <span>Theme</span>
        </button>
    </div>
</aside>

<main id="content">
    
<div id="post">
    <article>
<div class="post-header">
    <div id="post-meta" class="row">
        <strong>August 16, 2012</strong>
        
    </div>
    <h1><a class="post-title" href="/posts/2012-08-16-Easy-PDF-reports-with-clj-pdf.html">Easy PDF reports with clj-pdf</a></h1>
</div>
<div>
    
    <p>A few months ago I was tasked with generating reports for one of the applications I was working on. I looked around for some off the shelf libraries for doing this sort of thing. The most popular library in the Java world appears to be iText. It's a mature library with lots of features, but it takes entirely too much code to produce anything useful with it. On top of that, the latest version licensed under LGPL2 is 2.1.7 which, while serviceable, is full of quirks and odd behaviors.</p><p>After spending a bit of time playing with it I decided that it would make more sense to have a declarative API for describing the PDF document. I really like the way <a href='http://weavejester.github.com/hiccup/'>Hiccup</a> allows generating HTML using nested vectors, and decided that something similar could be done for generating PDF documents.</p><p>This lead to the creating of <a href='https://github.com/yogthos/clj-pdf'>clj-pdf</a>, which allows describing the document using this approach. Each vector represents a different element, such as a paragraph, a list, or a table. Internally, I leverage iText to produce the actual PDF document, but the API is completely declarative. The library attempts to abstract away any of the quirks as well as provide useful elements such as headings, spacers, page breaks, etc.</p><p>Let's look at how this all works in practice. A document is simply a vector which contains metadata describing it followed by one or more inner elements:<pre><code class="clojure">&#91;{:title &quot;My document&quot;} &quot;some content here...&quot;&#93;
</code></pre></p><p>In the spirit of Hiccup, each element is represented by a vector, where the first item must be a tag describing the type of the element, followed by optional metadata, and finally the content of the element. For example if we wanted to create a paragraph we'd do the following:<pre><code class="clojure">&#91;:paragraph &quot;a fine paragraph&quot;&#93;
</code></pre></p><p>to set the font style we could add the following metadata:<pre><code class="clojure">&#91;:paragraph
  {:style :bold :size 10 :family :halvetica :color &#91;0 255 221&#93;}
  &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;&#93;
</code></pre></p><p>any metadata in an element will propagate to its children:<pre><code class="clojure">&#91;:paragraph
  {:style :bold :size 12 :family :halvetica :color &#91;0 255 221&#93;}
  &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;
  &#91;:phrase &quot;some text here&quot;&#93;&#93;
</code></pre></p><p>here the phrase will inherit the font style of its parent paragraph. However, the child element is always free to overwrite the parent metadata:<pre><code class="clojure">&#91;:paragraph
  {:style :bold :size 12}
  &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;
  &#91;:phrase {:style :normal :size 10} &quot;some text here&quot;&#93;&#93;
</code></pre></p><p>This provides us with a lot of flexibility, while allowing to specify defaults for the entire document. The library attempts to provide reasonable behavior out of the box, so that adding metadata should not be necessary in most cases. </p><p>Some reports might include things like usage statistics. And to that end I leveraged the excellent <a href='http://www.jfree.org/jfreechart/'>JFreeChart</a> library to provide a simple charting API:<pre><code class="clojure">&#91;:chart {:type :line-chart 
         :title &quot;Line Chart&quot; 
         :x-label &quot;checkpoints&quot; 
         :y-label &quot;units&quot;} 
  &#91;&quot;Foo&quot; &#91;1 10&#93; &#91;2 13&#93; &#91;3 120&#93; &#91;4 455&#93; &#91;5 300&#93; &#91;6 600&#93;&#93;
  &#91;&quot;Bar&quot; &#91;1 13&#93; &#91;2 33&#93; &#91;3 320&#93; &#91;4 155&#93; &#91;5 200&#93; &#91;6 300&#93;&#93;&#93;
</code></pre></p><p>At this time bar charts, line charts, time series, and pie charts are supported. And because a chart is just an image, all the image styling, such as scaling and alignment, can be applied to it as well.</p><p>Since the API is completely declarative, it doesn't actually have to be encoded in Clojure structures. We could instead encode it in something like JSON, which is exactly what I ended up doing next. I created a service which would accept POST requests containing JSON encoded documents and return PDF documents. The service can be accessed by any application regardless of what language its written in, and can even be called by JavaScript from a browser as can be seen <a href='http://yogthos.net/instant-pdf/'>here</a>.</p><p>Documentation and examples are available on the <a href='https://github.com/yogthos/clj-pdf'>github project page</a>.</p>
</div>

<div id="post-tags">
    <br/>
    <b>Tags: </b>
    
    <a href="/clojure.html">clojure</a>
    
</div>

<br/>
</article>

    <div id="prev-next">
        
        <a class="button" href="/posts/2012-08-17-Noir-tutorial-part-1.html">&laquo; Noir tutorial - part 1</a>
        
        
        <a class="right button" href="/posts/2012-08-14-Blogging-with-Noir.html">Blogging with Noir &raquo;</a>
        
    </div>

    


</div>

    <hr/>
    <footer id="footercont">Copyright &copy; 2026 Dmitri Sotnikov
        <p>Powered by <a href="http://cryogenweb.org">Cryogen</a></p>
    </footer>
</main>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="/js/scripts.js" type="text/javascript"></script>


</body>
</html>
