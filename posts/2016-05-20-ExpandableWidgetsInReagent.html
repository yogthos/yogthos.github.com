<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="me" href="https://mastodon.social/@yogthos">
    <link rel="me" href="https://mas.to/@yogthos">
    <link rel="me" href="https://social.marxist.network/@yogthos">
    <title>(iterate think thoughts): Writing an expandable widget with Reagent</title>
    <meta name="description" content="Dmitri&#39;s blog about programming, Clojure, and software development">
    <meta name="keywords" content="">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <link href="/css/site.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)" id="hljs-light">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tomorrow-night-eighties.min.css" media="(prefers-color-scheme: dark)" id="hljs-dark">
    <script>
    (function(){var t=localStorage.getItem('theme');if(t){document.documentElement.setAttribute('data-theme',t);var l=document.getElementById('hljs-light'),d=document.getElementById('hljs-dark');if(l&&d){if(t==='dark'){l.media='not all';d.media='all'}else{l.media='all';d.media='not all'}}}})();
    </script>
</head>
<body>

<aside id="sidebar">

    <p id="logo">
        <a title="(iterate think thoughts)" href="/index.html">
            <span class="text"><span class="paren">(</span><span class="fn">iterate</span>
                <br>
                <span class="text">&nbsp;&nbsp;think</span>
                <br>
                <span class="text">&nbsp;&nbsp;thoughts<span class="paren">)</span>
            </span>
        </a>
    </p>

    <nav id="menucont" class="bodycontainer">
        <button class="menu-toggle" aria-label="Toggle menu">
            <span class="hamburger"></span>
            <span class="menu-label">Menu</span>
        </button>
        <ul class="menu">
            <li ><a title="Home" href="/index.html">Home</a></li>
            <li ><a title="Archives" href="/archives.html">Archives</a></li>
            
            <li ><a title="Tags" href="/tags.html">Tags</a></li>
            
            
            <li >
                <a href="/pages/about.html">About</a>
            </li>
            
            <li><a title="RSS" href="/feed.xml">RSS</a></li>
        </ul>
    </nav>

    <div class="theme-toggle-wrapper">
        <button class="theme-toggle" aria-label="Toggle dark mode">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></svg>
            <span>Theme</span>
        </button>
    </div>
</aside>

<main id="content">
    
<div id="post">
    <article>
<div class="post-header">
    <div id="post-meta" class="row">
        <strong>May 20, 2016</strong>
        
    </div>
    <h1><a class="post-title" href="/posts/2016-05-20-ExpandableWidgetsInReagent.html">Writing an expandable widget with Reagent</a></h1>
</div>
<div>
    
    <p>I recently needed to create an expandable widget and I wanted to be able to close it by clicking elsewhere on the screen. An example would be an input field and an associated component to select the input value such as a date picker.</p><p>We'll define an example component to look as follows:</p><pre><code class="clojure">&#40;defn expandable-component &#91;&#93;
  &#91;:div
   &#91;:input
    {:type :text}&#93;
   &#91;:table&gt;tbody      
    &#40;for &#91;row &#40;range 5&#41;&#93;
      &#91;:tr
       &#40;for &#91;n &#40;range 5&#41;&#93;
         &#91;:td&gt;button.btn
          {:on-click
           #&#40;do
              &#40;reset! value n&#41;
              &#40;reset! expanded? false&#41;&#41;} n&#93;&#41;&#93;&#41;&#93;&#93;&#41;
</code></pre><p>Next, we'll use the <code>with-let</code> statement to define some state for the component.</p><pre><code class="clojure">&#40;defn expandable-component1 &#91;&#93;
  &#40;r/with-let
    &#91;expanded? &#40;r/atom false&#41;
     value     &#40;r/atom nil&#41;&#93;
    &#91;:div
     &#91;:input
      {:type :text
       :value @value
       :on-click #&#40;swap! expanded? not&#41;}&#93;
     &#91;:table&gt;tbody
      {:style &#40;if @expanded?
                {:position :absolute}
                {:display &quot;none&quot;}&#41;}
      &#40;for &#91;row &#40;range 5&#41;&#93;
        &#91;:tr
         &#40;for &#91;n &#40;range 5&#41;&#93;
           &#91;:td&gt;button.btn.btn-secondary
            {:on-click
             #&#40;do
                &#40;reset! value n&#41;
                &#40;reset! expanded? false&#41;&#41;} n&#93;&#41;&#93;&#41;&#93;&#93;&#41;&#41;
</code></pre><p>The table is now hidden by default, and it's displayed when the user clicks the input. The table contains cells with numbers. When the user clicks a number, then the table is hidden and the input is reset to the value selected.</p><p>This works fine. However, the only way we can hide the table is by either picking a number or clicking on the input itself. It's not terrible, but it would be nicer if we could simply click off the table to have it go away.</p><p>The problem is that there is no local event the widget can use to detect that the user clicked elsewhere. So, what can we do here?</p><p>The solution I ended up using was to use a combination of events to detect the state of the widget. Let's see how this works below.</p><p>First, I added the <code>:on-blur</code> event to the input. When the input loses focus, the table is hidden. Now if I click elsewhere on the screen the table will disappear as intended.</p><p>Unfortunately, this breaks the interaction with the table itself. Since now the focus goes away and I'm no longer able to select the number I want.</p><p>In order to get around that problem we can use the <code>:on-mouse-enter</code> and <code>:on-mouse-leave</code> events on the table. This way we can check if the mouse is in the table before changing the visibility.</p><pre><code class="clojure">&#40;defn expandable-component &#91;&#93;
  &#40;r/with-let
    &#91;expanded? &#40;r/atom false&#41;
     value     &#40;r/atom nil&#41;
     mounse-on-table? &#40;r/atom false&#41;&#93;
    &#91;:div
     &#91;:input
      {:type :text
       :value @value
       :on-click #&#40;swap! expanded? not&#41;
       :on-blur #&#40;when-not @mounse-on-table? &#40;reset! expanded? false&#41;&#41;}&#93;
     &#91;:table&gt;tbody
      {:style &#40;if @expanded? {:position :absolute} {:display &quot;none&quot;}&#41;
       :on-mouse-enter #&#40;reset! mounse-on-table? true&#41;
       :on-mouse-leave #&#40;reset! mounse-on-table? false&#41;}
      &#40;for &#91;row &#40;range 5&#41;&#93;
        &#91;:tr
         &#40;for &#91;n &#40;range 5&#41;&#93;
           &#91;:td&gt;button.btn.btn-secondary
            {:on-click
             #&#40;do
                &#40;reset! value n&#41;
                &#40;reset! expanded? false&#41;&#41;} n&#93;&#41;&#93;&#41;&#93;&#93;&#41;&#41;
</code></pre><p>The new approach works as intended. The table will now close whenever the user clicks outside it. You can see this in action <a href='http://cljsfiddle.com/#gist=639bcbe8d328da071713729a714b7f65'>here</a>.</p><p>Hopefully this trick will save you some time creating these types of components in Reagent.</p>
</div>

<div id="post-tags">
    <br/>
    <b>Tags: </b>
    
    <a href="/reagent.html">reagent</a>
    
</div>

<br/>
</article>

    <div id="prev-next">
        
        <a class="button" href="/posts/2016-06-06-WorkingWithHoplon.html">&laquo; Consider Hoplon</a>
        
        
        <a class="right button" href="/posts/2016-04-28-Luminus-Workflow.html">Luminus Workflow &raquo;</a>
        
    </div>

    


</div>

    <hr/>
    <footer id="footercont">Copyright &copy; 2026 Dmitri Sotnikov
        <p>Powered by <a href="http://cryogenweb.org">Cryogen</a></p>
    </footer>
</main>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="/js/scripts.js" type="text/javascript"></script>


</body>
</html>
